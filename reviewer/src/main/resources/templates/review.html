<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>

<body>

    <header>
        <nav class="navbar navbar-dark bg-dark" aria-label="Dark offcanvas navbar">
            <div class="container-fluid">
                <a class="navbar-brand" th:href="@{/dashboard}">NITCONF</a>

               <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbarDark" aria-controls="offcanvasNavbarDark">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="offcanvas offcanvas-end text-bg-dark" tabindex="-1" id="offcanvasNavbarDark" aria-labelledby="offcanvasNavbarDarkLabel">
                    <div class="offcanvas-header">
                        <h5 class="offcanvas-title" id="offcanvasNavbarDarkLabel">Profile</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                    </div>
                    <div class="offcanvas-body">
                        <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                            <li class="nav-item">
                                <a class="nav-link active" aria-current="page" th:href="@{/profile}">View Profile</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    Sign Out
                                </a>
                                <ul class="dropdown-menu">
                                    <li>
                                        <form method="POST" th:action="@{/logout}">
                                            <input class="btn" type="submit" value="Logout"/>
                                        </form>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
                
         <!--  <div class="dropdown px-2">
            <a th:href="@{/profile}" class="d-flex align-items-center text-white text-decoration-none dropdown-toggle" id="dropdownUser1" data-bs-toggle="dropdown" aria-expanded="false">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
					  <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
					  <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"/>
					</svg>
                <strong class="ms-2">profile</strong>
            </a>
            <ul class="dropdown-menu dropdown-menu-dark text-small shadow py-2 min-width-rem" aria-labelledby="dropdownUser1">
                <li class="nav-item pt-2 px-2">
                                <a class="nav-link active" aria-current="page" th:href="@{/profile}">View Profile</a>
                            </li>
                
                                    <li class="nav-item pt-2 px-2">
                                        <form method="POST" th:action="@{/logout}">
                                            <input class="btn text-danger" type="submit" value="Logout"/>
                                        </form>
                                    </li>
                                </ul>
                            
            
        </div>-->
                
            </div>
        </nav>
    </header>

    <main>
        <div class="container-fluid overflow-hidden">
            <div class="row vh-100 overflow-auto">
                <div class="col-12 col-sm-3 col-xl-2 px-sm-2 px-0 bg-dark d-flex position-sticky">
                    <div class="d-flex flex-sm-column flex-row flex-grow-1 align-items-center align-items-sm-start px-3 pt-2 text-white">
                        
                        <hr>
                        <hr>
                        <ul class="nav nav-pills flex-column mb-auto">
                            <li>
                                <a th:href="@{/to-review}" class="nav-link text-white">
                                    ToReview
                                </a>
                            </li>
                            <li>
                                <a th:href="@{/drafts}" class="nav-link text-white">
                                    Drafts
                                </a>
                            </li>
                            <li>
                                <a th:href="@{/submissions}" class="nav-link text-white">
                                    Submissions
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>

                <div class="col-12 col-sm-9 col-xl-10 px-5 pt-5">
				   <div class="text-center container mb-3">
						<p class="h2 fw-bolder"> Review Form</p>
			       </div>
			   
			       <br>
				
				<div class="d-flex justify-content-center">
					
                    <div class="container w-75 ">
                        <div class="row">
                            <div class="col-md-8 border-right-0  bg-white bg-gradient">
                               <div class="m-2">
                                <strong><span class="h6 d-inline">Paper Id:</span></strong> <span class="fw-light" id="paperId"></span><br>
                               </div>
                               <div class="m-2 ">
                                <strong><span class="h6 ">Paper Name:</span></strong> <span class="fw-light" id="papername" ></span>
                               </div>
                               
                            </div>
                            <div class="col-md-4 bg-white bg-gradient">
                                <div class="m-2">
                                    <span class="h6 d-inline">Reviewer:</span> <span id="reviewername"></span><br>
                                </div>
                                <div class="m-2">
                                    <span class="h6 d-inline">Status:</span> <span id="reviewStatus"></span><br>
                                </div>
                                <div class="m-2">
                                    <span class="h6 d-inline">Deadline:</span> <span id="deadline"></span><br>
                                </div>
                                <div class="m-2">
                                    <span class="h6 d-inline">Submitted on:</span> <span class="d-none" id="submissionTime"></span><br>
                                </div>
                            </div>
                         </div>
                          
                         
                        <br><br>
                        
                     <form method="post" class="form">
                        <div class="row">
							<div class="col-md-8 border bg-light bg-gradient">
								<p class="m-2 fw-bold">Evalution Category</p>
							</div>
							<div class="col-md-4 border bg-light bg-gradient">
								<p class="m-2 fw-bold">Enter your Score (out of 10)</p>
							</div>
						</div>
						
						
						
						<div class="row">
							<div class="col-md-8  border bg-light bg-gradient">
								<p class="m-2 fw-normal">Technical Content and Accuracy</p>
							</div>
							
							<div class="col-md-4 border bg-light bg-gradient">
								<div class="d-flex justify-content-center">
								   <input class="form-control border-0  bg-light bg-gradient" name="technical" id="technical" min=0 max=10 type="number">
								</div>
							</div>
							
						</div>
						
						<div class="row">
							<div class="col-md-8  border bg-white bg-gradient">
								<p class="m-2 fw-normal">Significance od the Work</p>
							</div>
							
							<div class="col-md-4 border bg-white bg-gradient">
								<div class="d-flex justify-content-center">
								   <input class="form-control border-0  bg-light bg-gradient" name="significance" id="significance" min=0 max=10  type="number">
								</div>
							</div>
							
						</div>
						
						<div class="row">
							<div class="col-md-8  border bg-light bg-gradient">
								<p class="m-2 fw-normal">Appropriate Title, Introduction and Conclusion</p>
							</div>
							
							<div class="col-md-4 border bg-light bg-gradient">
								<div class="d-flex justify-content-center">
								   <input class="form-control border-0  bg-light bg-gradient" min=0 max=10 name="appropriate" id="appropriate" type="number" >
								</div>
							</div>
							
						</div>
						
						<div class="row">
							<div class="col-md-8  border bg-white bg-gradient">
								<p class="m-2 fw-normal">Overall Organization</p>
							</div>
							
							<div class="col-md-4 border bg-white bg-gradient">
								<div class="d-flex justify-content-center">
								   <input class="form-control border-0  bg-light bg-gradient" min=0 max=10 name="organization" id="organization" type="number"> 
								</div>
							</div>
							
						</div>
						
						
						
						<div class="row">
							<div class="col-md-8  border bg-light bg-gradient">
								<p class="m-2 fw-normal">Style and Clarity of Paper</p>
							</div>
							
							<div class="col-md-4 border bg-light bg-gradient">
								<div class="d-flex justify-content-center">
								   <input class="form-control border-0  bg-light bg-gradient" min=0 max=10  name="style" id="style" type="number">
								</div>
							</div>
							
						</div>
						
						<div class="row">
							<div class="col-md-8  border bg-white bg-gradient">
								<p class="m-2 fw-normal">Originality of Content</p>
							</div>
							
							<div class="col-md-4 border bg-white bg-gradient">
								<div class="d-flex justify-content-center">
								   <input class="form-control border-0  bg-light bg-gradient" min=0 max=10 name="originality" id="originality" type="number">
								</div>
							</div>
							
						</div>
						
						<div class="row">
							<div class="col-md-8  border bg-light bg-gradient">
								<p class="m-2 fw-normal">Referee's Confidence in Paper's Subject</p>
							</div>
							
							<div class="col-md-4 border bg-light bg-gradient">
								<div class="d-flex justify-content-center">
								   <input class="form-control border-0  bg-light bg-gradient" min=0 max=10 name="refeersConfidence" id="refeersConfidence" type="number">
								</div>
							</div>
							
						</div>
						
						<div class="row">
							<div class="col-md-8  border bg-white bg-gradient">
								<p class="m-2 fw-normal">Overall Recommendation</p>
							</div>
							
							<div class="col-md-4 border bg-white bg-gradient">
								<div class="d-flex justify-content-center">
								   <input class="form-control border-0  bg-light bg-gradient" min=0 max=10  name="overall" id="overall" type="number">
								</div>
							</div>
							
						</div>
						
						<br>
						<hr>
						
						<h4>Comments and Recommendations</h4>
						 <textarea class="form-control" rows=8  name="comment" id="comment" placeholder="Enter you Comments here"></textarea>
						 <div class="container d-flex flex-row-reverse">
							
					     <!-- <input class="btn btn-success m-3"  name="method" type="submit" value="Submit"> 
					     <input class="btn btn-secondary m-3" name="method" type="submit" value="Save to Draft">-->
					     
					     
					     <button class="btn btn-success m-3"  id="submission" onclick="toSubmissions()">Submit</button>
					     <button class="btn btn-secondary m-3"  id="drafts" onclick="toDrafts()">Save to Drafts</button>
					     <button class="btn btn-secondary m-3 d-none"  id="editSubmission" onclick="toeditSubmission()">ReSubmit</button>
					     <button class="btn btn-danger m-3" id="cancel" onclick="tocancel()">Cancel</button></a>
					     
					 </div>
						 
					 </form>	
               
                    
                    
                      </div>
                   </div>
                   
                </div>
            </div>
        </div>        
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous">
    </script>
    
    <script>
		

		
		//change layout according to review status
		
		//change date format
		
		const token = localStorage.getItem("token")
		const searchParams = new URLSearchParams(window.location.search)
		const paperId = searchParams.get("paperId")
		
		document.getElementById("cancel").setAttribute("href", `/api/review-center?token=${token}`)
		
		
		function setValue(id,value)
		{
			if(value !== null)
			 document.getElementById(id).setAttribute("value",value);
		}
		
		function setReviewDetails(review,paper)		
		{
			
			document.getElementById("paperId").textContent = paper.id;
		    document.getElementById("papername").textContent= paper.name;
		    document.getElementById("reviewername").textContent = review.id.userId;

		    
		    setValue("technical",review.technical)
		    setValue("significance",review.significance)
		    setValue("originality",review.originality)
		    setValue("appropriate",review.appropriate)
		    setValue("organization",review.organization)
		    setValue("style",review.style)
		    setValue("refeersConfidence",review.refeersConfidence)
		    setValue("overall",review.overall)
		    
		    if(review.comment !== null)
		      document.getElementById("comment").textContent = review.comment
				   
				   
		}
		
		async function getDataFromURL(url)
		{
			  const data = await fetch(url, 
			   {
				   method : `GET`,
				   headers: {
						 'Content-Type' : `application/json`,
						 'Authorization': `Bearer ${token}`
				   }
			    }) 
			    .then(res => res.json())    //return res.json  which is json
				.then(data =>{
					  
					  return data
				      
				 }).catch((error) => {
					 
					  console.log(error);   // error handling
			     });
			     
			  return data;
			     
		 }
		 
		 function modifyOnReviewStatus(review)
		 {
			 document.getElementById("deadline").textContent = review.deadline;
		    
			 if(review.reviewStatus == 'submit')
			 {
				document.getElementById("reviewStatus").textContent = 'submitted';
				//document.getElementById("reviewStatus").classList.add("text-success")
				
				const submissionTime =  document.getElementById("submissionTime")
				submissionTime.classList.remove("d-none")
				submissionTime.textContent = review.submissionTime;
				
				
				document.getElementById("submission").classList.add("d-none")
		        document.getElementById("drafts").classList.add("d-none")
		        document.getElementById("editSubmission").classList.remove("d-none")
				
				  
			 }
			 else
			 {
				 document.getElementById("reviewStatus").textContent = 'pending';
			 }
			 
		 }
		 
		 
		 let review;
		 let paper;
		 async function displayReviewDetails()
		 {
			 review = await getDataFromURL(`http://localhost:8080/api/review/get?paperId=${paperId}`)
			 paper = await getDataFromURL(`http://localhost:8080/api/get-paper?paperId=${paperId}`)
			 modifyOnReviewStatus(review)
             setReviewDetails(review,paper)
		 }
		 
		 displayReviewDetails()
		 
		  
		  
		 function toDrafts()
		 {
			 event.preventDefault()
			 const form = document.querySelector('.form');
			 const formData = new FormData(form);
			 const data = Object.fromEntries(formData)
			 
			 console.log(data)
			 
			 fetch(`http://localhost:8080/api/review/save?paperId=${paperId}`, {
			    method: 'POST',
			    headers: {
			      'Content-Type' : 'application/json',
			      'Authorization' : `Bearer ${token}`,
			    },
			    body: JSON.stringify(data) // Send data as JSON string
			  })
			  .then(res => res.json()) // Handle response (assuming JSON)
			  .then(data => {
				  
				   const url = `http://localhost:8080/api/drafts?token=${token}`
				   window.location.href = url
			       // Handle successful data submission
			  })
			  .catch(error => {
			    console.error("Error sending data:", error);
			  });
			
			
		 }
		 
		 function toSubmissions()
		 {
			 event.preventDefault()
			 const form = document.querySelector('.form');
			 const formData = new FormData(form);
			 const data = Object.fromEntries(formData)
			 
			 console.log(data)
			 
			 fetch(`http://localhost:8080/api/review/submit?paperId=${paperId}`, {
			    method: 'POST',
			    headers: {
			      'Content-Type' : 'application/json',
			      'Authorization' : `Bearer ${token}`,
			    },
			    body: JSON.stringify(data) // Send data as JSON string
			  })
			  .then(res => res.json()) // Handle response (assuming JSON)
			  .then(data => {
				  
				   const url = `http://localhost:8080/api/submissions?token=${token}`
				   window.location.href = url
			       // Handle successful data submission
			  })
			  .catch(error => {
			    console.error("Error sending data:", error);
			  });
		 }
		 
		 
		 function toeditSubmission()
		 {
			  event.preventDefault()
			 const form = document.querySelector('.form');
			 const formData = new FormData(form);
			 const data = Object.fromEntries(formData)
			 
			 console.log(data)
			 
			 fetch(`http://localhost:8080/api/edit-submission?paperId=${paperId}`, {
			    method: 'POST',
			    headers: {
			      'Content-Type' : 'application/json',
			      'Authorization' : `Bearer ${token}`,
			    },
			    body: JSON.stringify(data) // Send data as JSON string
			  })
			  .then(res => res.json()) // Handle response (assuming JSON)
			  .then(data => {
				  
				   const url = `http://localhost:8080/api/submissions?token=${token}`
				   window.location.href = url
			       // Handle successful data submission
			  })
			  .catch(error => {
			    console.error("Error sending data:", error);
			  });
			 
		 }
		 
		 function tocancel()
		 {
			 event.preventDefault()
			 window.location.href=`/api/review-center?token=${token}`
		 }
		 
		 
		 
		 
			  
		 
		 
		 
		
	</script>

</body>

</html>
