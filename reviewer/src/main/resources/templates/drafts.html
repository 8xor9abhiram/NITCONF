<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <!-- CSS File -->
    <link id="styles" rel="stylesheet" href="/css/styles.css" />
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  </head>
  <body>
      <header class="header">
            <div class="logo left">
             <!-- <i id="menu" class="material-icons">menu</i>  -->
             <!-- <img src="https://www.freecodecamp.org/news/content/images/2022/01/yt-logo.png"> -->
             
             <a class="navbar-brand text-light" id="dashboard" ><h4><strong>
				 <img id="logoImage" src=" " alt=" " width="25" heigth="25" />
				 NITCONF</strong></h4></a>
            </div>
            
            <div class="search center">
              <form action="">
                <input type="text" placeholder="Search" />
                <button><i class="material-icons">search</i></button>
              </form>  
            </div>
            
            <div class="icons right">
                <a href="/notifications">
                    <i class="material-icons">notifications</i>
                </a>
                
                <a id="profile">
                    <i class="material-icons display-this">account_circle</i>
                </a>
                
                
                <!-- <div class="dropdown">  
                    <button class="dropbtn"> 
                        <i class="material-icons display-this">account_circle</i>
                    </button>  
                    <div class="dropdown-content">  
                    <a href="https://www.javatpoint.com/html-tutorial"> Html </a>  
                    <a href="https://www.javatpoint.com/css-tutorial"> CSS </a>  
                    <a href="https://www.javatpoint.com/javascript-tutorial"> JavaScript </a>  
                    </div>  
                </div>  -->


               <!-- <div class="btn-group mx-3 my-3">
                    <button class="btn btn-sm" type="button">
                        <i class="material-icons display-this">account_circle</i>
                    </button>
                    <button type="button" class="btn btn-lg btn-secondary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
                      <span class="visually-hidden">Toggle Dropdown</span>
                    </button>
                    <ul class="dropdown-menu">
                          
                          <li><a class="dropdown-item" th:href="@{/review(action=view ,id=${review.paper.id})}">continue review</a></li>
                          <li><a class="dropdown-item" th:href="@{/review(action=clear ,id=${review.paper.id})}">clear review</a></li>
                          <li><hr class="dropdown-divider"></li>
                          <div class="text-center">
                          <li> <button type="button" class="btn btn-outline-danger">decline to review</button> </li>
                          </div>
                     </ul>
                </div>-->
            </div>
      </header>
      <main>
            <div class="side-bar">
                <div class="nav">
                    <a id="side-review-center" class="nav-link text-dark font-italic">
                        <strong>Review Center</strong>
                    </a>
                    <a  id="side-drafts" class="nav-link text-dark">
                        <strong>Drafts</strong>
                    </a>
                    <a id="side-submissions" class="nav-link text-dark">
                        <strong>Submissions</strong>
                    </a>
                </div>
                <hr>
              </div>
           
           <div class="content">
                    <div class="container text-center my-3">
			             <p class="h2 my-4 font-weight-normal">Drafts</p>
		            </div>
		  
		            <div class="container-md justify-content-center">
						<div class="container-md w-60" id="table">
							 <div class="row bg-light bg-gradient">
								<div class="col-md-1 border text-center  py-2">
									<p class="h6 font-weight-normal">Paper id</p>
								</div>
								<div class="col-md-6 border text-center  py-2">
									<p class="h6 font-weight-normal">Name</p>
								</div>
								<div class="col-md-3 border text-center  py-2">
									<p class="h6 font-weight-normal">Deadline</p>
								</div>
								<div class="col-md border text-center  py-2">
									<p class="h6 font-weight-normal">Actions</p>
								</div>
						     </div>
	            

	            	<div class="row">
						<div class="col-md-1 border py-2">
							<p class="d-inline">#</p> <p class="h6 d-inline" type="number"></p>
							<br>
							<br>
						</div>
						<div class="col-md-6 border py-2">
							<p class="h6 font-weight-normal">
							</p>
							<br>
							<a href="@{/file/{path}(path=${review.paper.pdfLink})}" target="_blank"><button class="btn btn-info mx-2">View PDF</button></a>
						    <div class="dropdown d-inline">
							 <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
							   View Tags
							  </button>
							  <ul class="dropdown-menu bg-light">
							    <li each="tag : ${review.paper.tags}" text="${tag.name}" class="p-1">Default</li>
							  </ul>
							</div>
	
						</div>
						<div class="col-md-3 border py-2 text-center">
							<p class="h6 font-weight-normal" text="">06/02/2024</p>
						</div>
						
						 <div class="col-md border py-2" > 
							<div class="btn-group mx-3 my-3">
								  <button class="btn btn-secondary btn-lg" type="button">
								    actions
								  </button>
								  <button type="button" class="btn btn-lg btn-secondary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
								    <span class="visually-hidden">Toggle Dropdown</span>
								  </button>
								  <ul class="dropdown-menu">
									    
									    <li><a class="dropdown-item" href="@{/review(action=view ,id=${review.paper.id})}">continue review</a></li>
									    <li><a class="dropdown-item" onclick="clearReview()" >clear review</a></li>
									    <li><hr class="dropdown-divider"></li>
									    <div class="text-center">
									      <li> <button type="button" class="btn btn-outline-danger">decline to review</button> </li>
									    </div>
							       </ul>
							</div>
	                      </div>  
				      </div>
                     </div>
                      </div>
                  </div>
                </div>
            </div>
        </div>        
    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
        crossorigin="anonymous">
    </script>
    
    <script>
		   const token = localStorage.getItem("token")
		   
		   
		   function getFormatDate(date)
		   {
			   const formatDate = date.getDate()+'/'+ date.getMonth()+'/'+ date.getYear()+" "+ date.getHours()+":"+ date.getMinutes()+":"+ date.getSeconds();
			   return formatDate;
			   
		   }
		   
		   async function getDataFromURL(url)
		   {
			  const data = await fetch(url, 
			   {
				   method : `GET`,
				   headers: {
						 'Content-Type' : `application/json`,
						 'Authorization': `Bearer ${token}`
				   }
			    }) 
			    .then(res => res.json())    //return res.json  which is json
				.then(data =>{
					  
					  return data
				      
				 }).catch((error) => {
					 
					  console.log(error);   // error handling
			     });
			     
			  return data;
			     
		   }
		   
		   async function setReviewDetails(review)
		   {
			  const element = document.getElementById('table')
			  innerHTML = `<div class="row bg-light bg-gradient">
				            <div class="col-md-1 border text-center  py-2">
				                <p class="h6 font-weight-normal">Paper id</p>
				            </div>
				            <div class="col-md-6 border text-center  py-2">
				                <p class="h6 font-weight-normal">Name</p>
				            </div>
				            <div class="col-md-3 border text-center  py-2">
				                <p class="h6 font-weight-normal">Deadline</p>
				            </div>
				            <div class="col-md border text-center  py-2">
				                <p class="h6 font-weight-normal">Actions</p>
				            </div>
				           </div>`
				           
				           
			  for(let i =0;i<review.length;i++)
			  {
				  console.log(review[i])
				  const paper = await getDataFromURL(`http://localhost:8080/api/get-paper?paperId=${review[i].id.paperId}`)
				  console.log(paper)
				  const deadline = new Date(review[i].deadline)
				  //const deadline = getFormatDate(new Date(review[i].deadline))
				  
      
                  
				  
				 innerHTML +=  `<div class="row">
		                          <div class="col-md-1 border py-2">
		                            <p class="d-inline">#</p> <p class="h6 d-inline" type="number">${paper.id}</p><br><br>
		                            <p class="text-danger font-italic">[Draft]<p/>
			                    </div>`
		                 
				 innerHTML +=   `
					             <div class="col-md-6 border py-2">
					                <p class="h6 font-weight-normal">${paper.name}</p><br>
					                <a href="/file/${paper.pdfLink}?token=${token}" target="_blank"><button class="btn btn-info mx-2">View PDF</button></a>
					                <div class="dropdown d-inline">
					                  <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
					                    View Tags
					                   </button>
					                   <ul class="dropdown-menu bg-light">`
		         paper.tags.forEach(tag => {
					console.log(tag.name)
				    innerHTML += ` <li class="p-1">${tag.name}</li>`
			  	});
						         
		               
		           
		           innerHTML += ` </ul>
		                          </div>
		                          </div>
						            <div class="col-md-3 border py-2 text-center">
						                <p class="h6 font-weight-normal">${deadline}</p>
						            </div>
						            
						            <div class="col-md border py-2" > 
							          <div class="btn-group mx-3 my-3">
										  <button class="btn btn-secondary btn-lg" type="button">
										    actions
										  </button>
										  <button type="button" class="btn btn-lg btn-secondary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
										    <span class="visually-hidden">Toggle Dropdown</span>
										  </button>
									      <ul class="dropdown-menu">
										    <li><a class="dropdown-item" href="/api/review/view?paperId=${paper.id}&token=${token}">continue review</a></li>
										    <li><a class="dropdown-item" onclick=clearReview("http://localhost:8080/api/review/clear?paperId=${paper.id}")>clear review</a></li>
										    <li><hr class="dropdown-divider"></li>
										    <div class="text-center">
										      <li> <button type="button" class="btn btn-outline-danger">decline to review</button> </li>
										    </div>
								         </ul>
								      </div>
		                            </div>  
						        </div>`
			  }
			  
			  element.innerHTML = innerHTML
			  
			   
		   }
		   
		   async function displayReview()
		   {
			  const data = await getDataFromURL('http://localhost:8080/api/get-drafts')
			  console.log(data)
			  setReviewDetails(data)
		   }
		   
		   displayReview()
		   
		 
		   
		   async function clearReview(url)
		   {
			  getDataFromURL(url)
			  window.location.href = `http://localhost:8080/api/drafts?token=${token}`
			 
		   }
		   

		   document.getElementById("profile").setAttribute("href", `/api/profile?token=${token}`);
		   document.getElementById("styles").setAttribute("href", `/css/styles.css?token=${token}`);
		   document.getElementById("side-review-center").setAttribute("href", `/api/review-center?token=${token}`);
		   document.getElementById("side-drafts").setAttribute("href", `/api/drafts?token=${token}`);
		   document.getElementById("side-submissions").setAttribute("href", `/api/submissions?token=${token}`);
		   document.getElementById("dashboard").setAttribute("href", `/api/dashboard?token=${token}`);
		   document.getElementById("logoImage").setAttribute("src", `/images/logoww.png?token=${token}`);

		   
		   
	</script>

</body>

</html>
