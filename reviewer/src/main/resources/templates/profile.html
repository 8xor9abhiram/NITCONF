<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
	
	<head>
		<title>Edit-profile</title>
	    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">

	</head>
	<body>
		
	<header>
	      <nav class="navbar navbar-dark bg-dark" aria-label="Dark offcanvas navbar">
          <div class="container-fluid">
            <a class="navbar-brand" th:href="@{/dashboard}">NITCONF</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbarDark" aria-controls="offcanvasNavbarDark">
              <span class="navbar-toggler-icon"></span>
            </button>

            <div class="offcanvas offcanvas-end text-bg-dark" tabindex="-1" id="offcanvasNavbarDark" aria-labelledby="offcanvasNavbarDarkLabel">
              <div class="offcanvas-header">
                <h5 class="offcanvas-title" id="offcanvasNavbarDarkLabel">Profile</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
              </div>
              <div class="offcanvas-body">
                <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                  <li class="nav-item">
                    <a class="nav-link active" aria-current="page" th:href="@{/profile}">View Profile</a>
                  </li>
                  <br>
    
                  <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                       Sign Out
                    </a>
                    <ul class="dropdown-menu">
                      <li>
						  <form method="POST" th:action="@{/logout}">
                               <input class="btn" type="submit" value="Logout"/>
                          </form>
                      </li>
                    </ul>
                  </li>
                </ul>
            
              </div>
            </div>
          </div>
        </nav>
     </header> 

		
		<main>
			<div class="container w-50">
				
	          
                <h2 class="my-4">PROFILE</h2>

				<div class="row d-flex">
					<div class="col-md-9">
						    <label class="form-label" for="username">Username:</label>
							<input class="form-control" id="username" disabled>
							<br>
							<label class="form-label" for="name">Name:</label>
						    <input class="form-control" id="name" disabled>
						    <br>
						    <label class="form-label" for="contactno">Contact No:</label>
						    <input class="form-control" id="contactno" disabled>
						    <br>
							  <label for="bio">Bio</label>
							  <textarea class="form-control" id="bio" disabled></textarea>			
							<br>
							<div class="tags">
							<p>Tags:</p>
							<ul class="list-group list-group-vertical" id="tag-list">
							   <!-- <li  class="list-group-item list-group-item-light"></li>-->
							</ul>
							</div>
							<br>
                           
                          <div class="d-flex justify-content-center">
							<a id ="edit" href ="/edit-profile"><button class="btn btn-primary mx-4">Edit Profile</button></a>
						   </div> 

			      </div>
				</div>
			    
		    </div>
		</main>
		
	
	   
	   
       <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
	   <script>
		       function setUserDetails(data)
		       {
			
				   document.getElementById("username").setAttribute("value" , data.username);
				   //username will always be valid 
				   
				   if(!(data.name === null))
				   {
					   document.getElementById("name").setAttribute("value" , data.name);
				   }
				   
				   if(!(data.bio === null))
				   {
					    document.getElementById("bio").textContent = data.bio 
				   }
				   

				   if(!(data.contactno === null))
				   {
					   document.getElementById("contactno").setAttribute("value" , data.contactno);
				   } 
				    
				   
				   
				   
				     // what to do if it is null
				    
				   const tags = data.tags
				   for(let i=0;i< tags.length;i++)
				   {
					   const element = document.createElement("li")
					   const node = document.createTextNode(tags[i].name);
					   element.classList.add("list-group-item")
					   element.classList.add("list-group-item-light")
					   element.id = "tag_"+tags[i].id;                      //remember to remove tag_ while json
					   element.appendChild(node);
					   
					   const parent = document.getElementById("tag-list")
					   parent.appendChild(element)
				   }
				   
			   }
		       
	           const token = localStorage.getItem("token")
	           const element = document.getElementById("edit")
	           element.setAttribute("href" , `/api/edit-profile?token=${token}`)
			   fetch('http://localhost:8080/api/get-profile',
			   {
				   method : 'GET',
				   headers: {
						 'Content-Type' : 'application/json',
						 'Authorization': `Bearer ${token}`
				   }
			    }) 
			    .then(res => res.json())    //return res.json  which is json
				.then(data =>{
					
					 console.log(data)
					 setUserDetails(data)
				      
				 });
				 /**.catch((error) => {
					      
						  console.log(error);
			     });**/
			        
				   
			   
				   
	   </script>
	</body>
</html>