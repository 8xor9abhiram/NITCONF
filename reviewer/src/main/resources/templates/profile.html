<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <!-- CSS File -->
    <link id="styles" rel="stylesheet" href="/css/styles.css" />
    <title>Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  </head>
  <body>
      <header class="header">
            <div class="logo left">
             <!-- <i id="menu" class="material-icons">menu</i>  -->
             <!-- <img src="https://www.freecodecamp.org/news/content/images/2022/01/yt-logo.png"> -->
              <a class="navbar-brand" id="dashboard">NITCONF</a>
            </div>
            
            <div class="search center">
              <form action="">
                <input type="text" placeholder="Search" />
                <button><i class="material-icons">search</i></button>
              </form>  
            </div>
            
            <div class="icons right">
                <a href="/notifications">
                    <i class="material-icons">notifications</i>
                </a>
                
                <a id="profile">
                    <i class="material-icons display-this">account_circle</i>
                </a>
                
                
                <!-- <div class="dropdown">  
                    <button class="dropbtn"> 
                        <i class="material-icons display-this">account_circle</i>
                    </button>  
                    <div class="dropdown-content">  
                    <a href="https://www.javatpoint.com/html-tutorial"> Html </a>  
                    <a href="https://www.javatpoint.com/css-tutorial"> CSS </a>  
                    <a href="https://www.javatpoint.com/javascript-tutorial"> JavaScript </a>  
                    </div>  
                </div>  -->


               <!-- <div class="btn-group mx-3 my-3">
                    <button class="btn btn-sm" type="button">
                        <i class="material-icons display-this">account_circle</i>
                    </button>
                    <button type="button" class="btn btn-lg btn-secondary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
                      <span class="visually-hidden">Toggle Dropdown</span>
                    </button>
                    <ul class="dropdown-menu">
                          
                          <li><a class="dropdown-item" th:href="@{/review(action=view ,id=${review.paper.id})}">continue review</a></li>
                          <li><a class="dropdown-item" th:href="@{/review(action=clear ,id=${review.paper.id})}">clear review</a></li>
                          <li><hr class="dropdown-divider"></li>
                          <div class="text-center">
                          <li> <button type="button" class="btn btn-outline-danger">decline to review</button> </li>
                          </div>
                     </ul>
                </div>-->
            </div>
      </header>

		
		<main>
			
			<div class="side-bar">
                <div class="nav">
                    <a id="side-review-center" class="nav-link">
                        Review Center
                    </a>
                    <a  id="side-drafts" class="nav-link">
                        Drafts
                    </a>
                    <a id="side-submissions" class="nav-link">
                        Submissions
                    </a>
                </div>
                <hr>
              </div>
              
           <div class="content">
			<div class="container w-50">
				
	          
                <h2 class="my-4">PROFILE</h2>

				<div class="row d-flex">
					<div class="col-md-9">
						    <label class="form-label" for="username">Username:</label>
							<input class="form-control" id="username" disabled>
							<br>
							<label class="form-label" for="name">Name:</label>
						    <input class="form-control" id="name" disabled>
						    <br>
						    <label class="form-label" for="contactno">Contact No:</label>
						    <input class="form-control" id="contactno" disabled>
						    <br>
							  <label for="bio">Bio</label>
							  <textarea class="form-control" id="bio" disabled></textarea>			
							<br>
							<div class="tags">
							<p>Tags:</p>
							<ul class="list-group list-group-vertical" id="tag-list">
							   <!-- <li  class="list-group-item list-group-item-light"></li>-->
							</ul>
							</div>
							<br>
                           
                          <div class="d-flex justify-content-center">
							<a id ="edit" href ="/edit-profile"><button class="btn btn-primary mx-4">Edit Profile</button></a>
						   </div> 

			      </div>
				</div>
			    
		    </div>
		   </div>
		</main>
		
	
	   
	   
       <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
	   <script>
		       function setUserDetails(data)
		       {
			
				   document.getElementById("username").setAttribute("value" , data.username);
				   //username will always be valid 
				   
				   if(!(data.name === null))
				   {
					   document.getElementById("name").setAttribute("value" , data.name);
				   }
				   
				   if(!(data.bio === null))
				   {
					    document.getElementById("bio").textContent = data.bio 
				   }
				   

				   if(!(data.contactno === null))
				   {
					   document.getElementById("contactno").setAttribute("value" , data.contactno);
				   } 
				    
				   
				   
				   
				     // what to do if it is null
				    
				   const tags = data.tags
				   for(let i=0;i< tags.length;i++)
				   {
					   const element = document.createElement("li")
					   const node = document.createTextNode(tags[i].name);
					   element.classList.add("list-group-item")
					   element.classList.add("list-group-item-light")
					   element.id = "tag_"+tags[i].id;                      //remember to remove tag_ while json
					   element.appendChild(node);
					   
					   const parent = document.getElementById("tag-list")
					   parent.appendChild(element)
				   }
				   
			   }
		       
	           const token = localStorage.getItem("token")
	           
			   fetch('http://localhost:8080/api/get-profile',
			   {
				   method : 'GET',
				   headers: {
						 'Content-Type' : 'application/json',
						 'Authorization': `Bearer ${token}`
				   }
			    }) 
			    .then(res => res.json())    //return res.json  which is json
				.then(data =>{
					
					 console.log(data)
					 setUserDetails(data)
				      
				 })
				 .catch((error) => {
					      
						  console.log(error);
			     });
			   
			   
			   document.getElementById("profile").setAttribute("href", `/api/profile?token=${token}`);
		       document.getElementById("styles").setAttribute("href", `/css/styles.css?token=${token}`);
			   document.getElementById("side-review-center").setAttribute("href", `/api/review-center?token=${token}`);
		       document.getElementById("side-drafts").setAttribute("href", `/api/drafts?token=${token}`);
		       document.getElementById("side-submissions").setAttribute("href", `/api/submissions?token=${token}`);
		       document.getElementById("dashboard").setAttribute("href", `/api/dashboard?token=${token}`);
		       
		       document.getElementById("edit").setAttribute("href" , `/api/edit-profile?token=${token}`)
			        
				   
			   
				   
	   </script>
	</body>
</html>